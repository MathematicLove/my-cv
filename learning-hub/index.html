<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Learning Hub</title>
  <link rel="icon" href="../assets/img/favicon-32.png" sizes="32x32" type="image/png">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    .learning-hub-page { max-width: 720px; margin: 0 auto; padding: 1.5rem 1rem; }
    .learning-hub-home { margin-bottom: 1.5rem; }
    #markdown-root { margin-top: 0; }
  </style>
</head>
<body>
  <div class="learning-hub-page">
    <div class="learning-hub-home">
      <a href="../index.html" class="btn btn--home" id="to-home-btn" aria-label="Home">
        <svg class="btn-icon btn-icon--home" viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        <span id="to-home-label">Home</span>
      </a>
    </div>
    <div id="markdown-root"></div>
  </div>

  <script>
(function () {
  var lang = localStorage.getItem('lang') || 'en';
  document.documentElement.lang = lang;
  var homeLabel = document.getElementById('to-home-label');
  if (homeLabel) homeLabel.textContent = lang === 'ru' ? 'Домой' : 'Home';

  const root = document.getElementById('markdown-root');

  // Preprocess: [[slug]] or [[slug|text]] -> markdown link to ?page=slug
  function wikiLinks(md) {
    return md.replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g, function (_, slug, text) {
      var label = (text || slug).trim();
      var target = '?page=' + encodeURIComponent(slug.trim());
      return '[' + label + '](' + target + ')';
    });
  }

  function getPageFromUrl() {
    var params = new URLSearchParams(window.location.search);
    var page = params.get('page') || 'python';
    return page.replace(/[^a-z0-9_-]/gi, '') || 'python';
  }

  function render(html) {
    root.innerHTML = html;
    root.querySelectorAll('a[href^="?page="]').forEach(function (a) {
      a.addEventListener('click', function (e) {
        e.preventDefault();
        var href = a.getAttribute('href');
        if (href) {
          var newUrl = window.location.pathname + href;
          window.history.pushState({}, '', newUrl);
          loadPage();
        }
      });
    });
  }

  function loadPage() {
    var slug = getPageFromUrl();
    var mdPath = slug + '.md';
    fetch(mdPath)
      .then(function (r) {
        if (!r.ok) throw new Error('Not found');
        return r.text();
      })
      .then(function (md) {
        var withWiki = wikiLinks(md);
        if (typeof marked !== 'undefined') {
          marked.setOptions({ gfm: true });
          render(marked.parse(withWiki));
        } else {
          render('<pre>' + withWiki.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>');
        }
      })
      .catch(function () {
        root.innerHTML = '<p>Page not found. <a href="?page=python">Python</a></p>';
      });
  }

  window.addEventListener('popstate', loadPage);
  loadPage();
})();
  </script>
</body>
</html>
